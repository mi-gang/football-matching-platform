<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/web/css/common.css" />
    <title>구장 상세 정보</title>
</head>

<body>
    <header id="navbar"></header>
    <section class="container-fluid d-flex justify-content-center" id="sectionView">

        <div class="d-flex justify-content-center" id="maincontents">
            <!-- 여기서부터 내용 작성! -->
            <div class="d-flex flex-column align-items-center">

                <div class="" id="fieldInfo">
                    <!-- 구장 이름 -->
                    <div class="m-5 text-center">
                        <h2 th:text="${fieldInfo.f.fieldName}">인천 더피치 인하점 B구장</h2>
                    </div>

                    <!-- 구장 사업자 등록증 파일 다운
                    구장 신청 정보 O / 상세 정보 페이지 X  -->
                    <div class="row" th:if="${session.managerId == null}">
                        <div class="d-flex justify-content-end">
                            <div class="d-flex border border-1 border-black rounded-3 p-2 m-3">
                                <span class="ps-2 pe-3">첨부파일</span>
                                <div class="vr pe-1 me-2"></div>
                                <span class="ps-2 pe-4">사업자등록증.pdf</span>
                                <a href="web/img/search.svg" download="">
                                    <img src="common/">
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- 이미지 -->
                    <img class="mb-4" th:src="@{'../upload/img/' + ${fieldInfo.fi.fieldImg}}" id="fieldimg">

                    <!-- 구장 매니저 & 구장 정보 -->
                    <div class="row">
                        <div class="col">
                            <h4 class="p-1">매니저 정보</h4>
                            <div class="d-flex align-items-center border border-black rounded-5 p-3">
                                <table class="table table-borderless text-center m-0">
                                    <tbody>
                                        <tr>
                                            <td>구장 매니저</td>
                                            <td th:text="${fieldInfo.m.name}">이름</td>
                                        </tr>
                                        <tr>
                                            <td>아이디</td>
                                            <td th:text="${fieldInfo.m.managerId}">아이디</td>
                                        </tr>
                                        <tr>
                                            <td>연락처</td>
                                            <td th:text="${fieldInfo.m.phoneNumber}">전화번호</td>
                                        </tr>
                                        <tr>
                                            <td>이메일</td>
                                            <td th:text="${fieldInfo.m.email}">이메일</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col">
                            <h4 class="p-1">구장 정보</h4>
                            <div class="d-flex align-items-center border border-black rounded-5 p-3">
                                <table class="table table-borderless text-center m-0">
                                    <tbody>
                                        <tr>
                                            <td>구장 이름</td>
                                            <td style="width: 70%;" th:text="${fieldInfo.f.fieldName}">구장 이름</td>
                                        </tr>
                                        <tr>
                                            <td>구장 주소</td>
                                            <td th:text="${fieldInfo.f.fieldAddress} + ' ' + ${fieldInfo.f.fieldAddressDetail}">인천광역시 광진구 자양로41길 25-13 2층</td>
                                        </tr>
                                        <tr>
                                            <td>구장 정보</td>
                                            <td>
                                            	<span class="pe-2" th:if="${fieldInfo.f.showerRoom}">샤워실</span>
                                            	<span class="pe-2 text-decoration-line-through" th:if="${!fieldInfo.f.showerRoom}">샤워실</span>
                                            	<span class="pe-2" th:if="${fieldInfo.f.parking}">주차</span>
                                            	<span class="pe-2 text-decoration-line-through" th:if="${!fieldInfo.f.parking}">주차</span>
                                                <span th:if="${fieldInfo.f.rentShoes}">풋살화 대여</span>
                                                <span class="text-decoration-line-through" th:if="${!fieldInfo.f.rentShoes}">풋살화 대여</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td>
                                            	<span class="pe-2" th:if="${fieldInfo.f.sellDrink}">음료판매</span>
                                            	<span class="pe-2 text-decoration-line-through" th:if="${!fieldInfo.f.sellDrink}">음료판매</span>
                                                <span th:if="${fieldInfo.f.rentBall}">풋살공 대여</span>
                                                <span class="text-decoration-line-through" th:if="${!fieldInfo.f.rentBall}">풋살공 대여</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- 소개글 -->
                    <div class="row  mt-2 p-3">
                        <h4 class="p-1">소개글</h4>
                        <div class="border border-black rounded-5 p-3">
                            <div class="col p-3" id="fieldContent">
                                <ul class="m-0">
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 경기 일정
                    시스템 매니저일 경우 O / 구장 매니저일 경우 X -->
                    <div class="row  mt-2 p-3" th:if="${session.managerId == null}">
                        <h4 class="p-1">경기 일정</h4>
                        <div class="border border-black rounded-5 p-3">

                            <div class="d-flex justify-content-between">
                                <!-- 캘린더 -->
                                <div class="d-flex flex-column border-end border-secondary p-3">
                                    <div class="row p-3">
                                        <div class="col d-flex justify-content-center">
                                            <img class="calendar-nav-btn" id="prevBtn" src="/web/img/left arrow.svg"
                                                alt="이전 달 버튼"></img>
                                            <div class="year-month"></div>
                                            <img class="calendar-nav-btn" id="nextBtn" src="/web/img/right arrow.svg"
                                                alt="다음 달 버튼"></img>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="calendar-days">
                                            <div class="day sun">일</div>
                                            <div class="day">월</div>
                                            <div class="day">화</div>
                                            <div class="day">수</div>
                                            <div class="day">목</div>
                                            <div class="day">금</div>
                                            <div class="day sat">토</div>
                                        </div>
                                        <div class="calendar-dates" id="calendarDates"></div>
                                    </div>
                                </div>

                                <!-- 일정  -->
                                <div class="col d-flex flex-column text-center ms-2">
                                    <div class="row border border-secondary rounded-3 m-1">
                                        <p class="m-0 p-3">12:00-14:00</p>
                                    </div>
                                    <div class="row border border-secondary rounded-3 m-1">
                                        <p class="m-0 p-3">12:00-14:00</p>
                                    </div>
                                    <div class="row border border-secondary rounded-3 m-1">
                                        <p class="m-0 p-3">12:00-14:00</p>
                                    </div>

                                </div>

                            </div>

                        </div>
                    </div>

                    <div class="d-flex justify-content-center m-5" th:if="${session.managerId == null}">
                        <button class="btn btn-dark btn-lg p-2 ps-5 pe-5" id="deleteBtn" th:if="${fieldInfo.f.fieldStatus == 1}">삭제</button>
                    </div>
                    <div class="d-flex justify-content-center m-5" th:if="${session.managerId == null}">
                        <button class="btn btn-dark btn-lg p-2 ps-5 pe-5 me-5" id="okBtn" th:if="${fieldInfo.f.fieldStatus == 0}">승인</button>
                        <button class="btn border-black border-1 btn-lg p-2 ps-5 pe-5" id="nopeBtn" th:if="${fieldInfo.f.fieldStatus == 0}">거절</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        $("#navbar").load("../common/navbarManager.html");

        var text = `[[${fieldInfo.f.fieldContent}]]`

        var content = text.split('\n');
        var str = "";
        for (i = 0; i < content.length; i++) {
            str += "<li class='p-2'>" + content[i] + "</li>";
        }
        $("#fieldContent > ul").html(str);

        $("#okBtn").on('click', function () {
           // confirm("승인 하시겠습니까?")
            
            
            
            const url = window.location.href; // Get the current URL
			const match = url.match(/fieldInfo\/(\d+)/); // Extract the matching part using regex
			const fieldSeq = parseInt(match[1]); // Parse the extracted value to a number
			console.log(fieldSeq); // Display the value in the console
 
            
            
        const data = fieldSeq;
        $.ajax({
            type: 'post',
            url: '/api/update/approve/date',
            data: JSON.stringify(data),
            contentType : 'application/json; charset=utf-8',
        
        }).done(function(response){ // 데이터 받아와서 뿌려주는 거 해야 됨ㅇㅇ
            console.log('구장 상태')
			console.log(response.result)
			window.location.replace('/fieldApplyList');

        }).fail(function(error){
            //alert(JSON.stringify(error));
        })
            
        window.location.replace('/fieldApplyList');    
            
        })

        $("#nopeBtn").on('click', function () {
            //confirm("거절 하시겠습니까?")
            
            const url = window.location.href; // Get the current URL
			const match = url.match(/fieldInfo\/(\d+)/); // Extract the matching part using regex
			const fieldSeq = parseInt(match[1]); // Parse the extracted value to a number
			console.log(fieldSeq); // Display the value in the console
 
            
            
        const data = fieldSeq;
        $.ajax({
            type: 'post',
            url: '/api/no/approve/field',
            data: JSON.stringify(data),
            contentType : 'application/json; charset=utf-8',
        
        }).done(function(response){ // 데이터 받아와서 뿌려주는 거 해야 됨ㅇㅇ
            console.log('구장 상태')
			console.log(response.result)
window.location.replace('/fieldApplyList');
        }).fail(function(error){
            //alert(JSON.stringify(error));
        })
            
        
            
        })










        $("#deleteBtn").on('click', function () {
            confirm("삭제 하시겠습니까?")
        })

        // ==========================================캘린더 부분
        // 캘린더 생성
        const date = new Date();
        let currentYear = date.getFullYear();
        let currentMonth = date.getMonth();
        let currentDate = date.getDate();

        const calendarDates = document.querySelector("#calendarDates");
        const prevBtn = document.querySelector("#prevBtn");
        const nextBtn = document.querySelector("#nextBtn");

        // const calendarDates =  $("#calendarDates");
        // const prevBtn = $("#prevBtn");
        // const nextBtn = $("#nextBtn");

        function renderCalendar() {
            $('.year-month').text(`${currentYear}년 ${currentMonth + 1}월`);

            const firstDayOfMonth = new Date(currentYear, currentMonth, 1); // 첫번째 날 불러오기
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();   // 날짜수 불러오기

            const startDayOfWeek = firstDayOfMonth.getDay();

            calendarDates.innerHTML = ""; // 일자 비우기

            // 빈 날짜(이전 달)
            for (let i = 0; i < startDayOfWeek; i++) {
                const emptyDate = document.createElement("div");
                emptyDate.classList.add("date", "empty");
                calendarDates.appendChild(emptyDate);
            }

            // 현재 달의 날짜
            for (let i = 1; i <= daysInMonth; i++) {

                // date-wrapper
                const dateWrapperElement = document.createElement("div");
                dateWrapperElement.classList.add("date-wrapper");

                // 날짜
                const dateElement = document.createElement("div");
                dateElement.classList.add("date");
                dateElement.setAttribute('id', currentYear + "-" + parseInt(currentMonth + 1) + "-" + i);
                dateElement.textContent = i;
                if (i == currentDate && date.getMonth() == currentMonth) 
                    dateElement.classList.add("today");

                // 매칭 여부
                const matchingDateElement = document.createElement("div");
                matchingDateElement.classList.add("isMatching");

                // 매칭 정보 있는 날이면 등록, 매칭 상태 불러와서 매칭 상태에 따라 다른 클래스 지정
                if (i == 5)
                    matchingDateElement.dataset.matchingStatus = "2";

                dateWrapperElement.appendChild(dateElement);
                dateWrapperElement.appendChild(matchingDateElement);
                calendarDates.appendChild(dateWrapperElement);
            }
        }

        renderCalendar();

        // 이전 달 버튼 클릭 시
        prevBtn.addEventListener("click", () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        // 다음 달 버튼 클릭 시
        nextBtn.addEventListener("click", () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // 날짜 클릭 시
        $(".calendar-dates").on("click", ".date-wrapper", function () {
        	if($(this).children('div:eq(0)').hasClass('today')){
            	$('.click-date').removeClass('click-date');       	
        		return;
        	}
            $('.click-date').removeClass('click-date');
            $(this).find('.date').addClass('click-date'); // find -> 자식 요소 찾기

            // 클릭한 날짜 불러오기
            console.log($(this).find('.date').attr("id"));
        });


    </script>
</body>

</html>