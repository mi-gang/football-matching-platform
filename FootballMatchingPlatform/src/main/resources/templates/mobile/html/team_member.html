<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="mobile/css/common.css" />
    <link rel="stylesheet" href="mobile/css/team.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

</head>

<body>
    <!-- 모바일 컨테이너 -->
    <div id="mobile-container">
        <!-- 헤더 -->
        <header></header>
        <!-- 컨텐츠 컨테이너 -->
        <div id="container">

            <div class="d-flex flex-column align-items-center gap-2 w-100 ps-3 pe-3 mt-3">

                <!-- 팀 정보 -->
                <div th:each="member, i:${memberList}"
                    class="d-flex align-items-center justify-content-between w-100 border border-2 rounded-4 p-3">
                    <div class="row w-50">
                        <div class="name">
                            <span class="teamname" th:text="${member.nickname}">
                            </span>
                            <span th:if="${member.newbie == true} and ${!i.first}">
                                <span class="nickBadge">new</span>
                            </span>

                            <span th:if="${i.first}">
                                <img src="mobile/img/leader.svg" class="teamKing ms-2">
                            </span>

                            <div class="content-info" th:text="${member.email}"></div>
                        </div>
                    </div>
                    <div class="">
                        <span class="p-0" th:text="${member.age}+ '세/'+${member.gender =='M' ? '남':'여'}"></span>
                        <span class="badge rounded-4 ms-1" th:text="${member.userTier}"></span>
                    </div>
                    <div class="row deleteMemberBox">
                        <div th:if="${!i.first}">
                            <a class="deleteImg" data-bs-toggle="modal" data-bs-target="#deleteMemberModal"
                                th:data-membername="${member.nickname}" th:data-memberid="${member.userId}">
                                <img src="mobile/img/Close.svg">
                            </a>
                        </div>

                    </div>
                </div>

                <!-- 팀원 추방 모달 -->
                <div class="modal" id="deleteMemberModal" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content align-items-center">
                            <div class="modal-header border-bottom-0 m-2">
                                <h1 class="modal-title fs-5" id="teamModalTitle"></h1>
                            </div>
                            <div class="modal-body">
                                <p>추방 하시겠습니까?</p>
                            </div>
                            <div class="modal-footer justify-content-center border-top-0">
                                <button type="button" class="btn btn-success" id="updateMemberDelete">추방하기</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
        <!-- 하단 메뉴바 -->
        <nav></nav>
    </div>

    <script>
        const url = new URL(window.location.href);
        const urlParams = url.searchParams;
        var teamSeq = urlParams.get('teamSeq');
        // header, nav 내용 불러오기
        $(document).ready(function () {
            $("header").load("./common/header_back.html", function () {
                // 뒤로가기 필요한 페이지는 header_back, 아닌 페이지는 header 사용해주세욤
                $("#page-name").text("팀원 목록"); // 해당 페이지 이름 넣어주세욤 ex) 마이페이지
                $("#user-tier").text("B"); // 나중에 세션에서 usertier 구해서 넣기
            });
            $("nav").load("./common/nav.html");

        });

        window.onload = function () {
            // $('#deleteMemberModal').on('show.bs.modal', function (event) {
            //     membername = $(event.relatedTarget).data('membername');
            //     $('#teamModalTitle').text("[ " + membername + " ]");
            //     memberId = $(event.relatedTarget).data('memberid')

            //     //deleteMemberClick(memberId);
            // });
        }
        
        $(".deleteImg").on("click", function(){
            var memberId = $(this).attr("data-memberid");
            var membername = $(this).attr("data-membername");
            $('#teamModalTitle').text("[ " + membername + " ]");
            $("#updateMemberDelete").attr("data-memberid", memberId);
            $("#updateMemberDelete").attr("data-membername", membername);
        })


            $("#updateMemberDelete").on('click', function () {
                var memberId = $(this).attr("data-memberid");
                var membername = $(this).attr("data-membername");
                var btn = $(this);
                if (btn.prop('disabled')) return false;
                btn.prop('disabled', true);

                $.ajax({
                    url: "/team/updateDelete/" + memberId,
                    type: "Put",
                    dataType: "json",
                    success: function (data) {
                        btn.prop('disabled', false);
                        console.log(teamSeq);
                        location.href = "/teamMember?teamSeq=" + teamSeq;
                    },
                    error: function () {
                        alert("error");
                    }
                });
            });
        


    </script>
</body>

</html>