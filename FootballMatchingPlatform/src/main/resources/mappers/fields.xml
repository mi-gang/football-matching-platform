<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kosta.project.repository.FieldMapper">

	<!-- 구장 전체 리스트 불러오기 -->
	<select id="selectFieldList" resultType="com.kosta.project.dto.FieldDTO">
		SELECT field_status as fieldStatus, f.field_seq AS fieldSeq, field_name AS fieldName, field_img AS fieldImg, field_address AS fieldAddress, field_address_detail AS fieldAddressDetail,
               shower_room AS showerRoom, rent_ball AS rentBall, rent_shoes AS rentShoes, parking, sell_drink AS sellDrink
        FROM fields f, field_imgs fi
        WHERE f.field_seq = fi.field_seq AND field_status = true
	</select>
	
	<!-- 특정 이름을 가진 구장 불러오기 -->
	<select id="selectFieldListByFieldName" parameterType="java.lang.String" resultType="com.kosta.project.dto.FieldDTO">
	SELECT f.field_seq AS fieldSeq, field_name AS fieldName, field_img AS fieldImg, field_address AS fieldAddress, field_address_detail AS fieldAddressDetail,
               shower_room AS showerRoom, rent_ball AS rentBall, rent_shoes AS rentShoes, parking, sell_drink AS sellDrink
    FROM fields f, field_imgs fi
	WHERE f.field_seq = fi.field_seq AND field_name REGEXP #{fieldName} AND field_status = true
	</select>
	
	<!-- 특정 시/도에 있는 구장 불러오기 -->
	<select id="selectFieldListByRegion" parameterType="java.lang.String" resultType="com.kosta.project.dto.FieldDTO">
	SELECT f.field_seq AS fieldSeq, field_name AS fieldName, field_img AS fieldImg, field_address AS fieldAddress, field_address_detail AS fieldAddressDetail,
               shower_room AS showerRoom, rent_ball AS rentBall, rent_shoes AS rentShoes, parking, sell_drink AS sellDrink
    FROM fields f, field_imgs fi
    WHERE f.field_seq = fi.field_seq AND field_address REGEXP #{fieldAddress} AND field_status = true
	</select>
	
	<!-- 특정 시/도에 있고, 특정 이름을 가진 구장 불러오기 -->
	<select id="selectFieldListByFieldNameAndRegion" parameterType="com.kosta.project.dto.FieldDTO"  resultType="com.kosta.project.dto.FieldDTO">
		SELECT f.field_seq AS fieldSeq, field_name AS fieldName, field_img AS fieldImg, field_address AS fieldAddress, field_address_detail AS fieldAddressDetail,
               shower_room AS showerRoom, rent_ball AS rentBall, rent_shoes AS rentShoes, parking, sell_drink AS sellDrink
        FROM fields f, field_imgs fi
        WHERE f.field_seq = fi.field_seq AND field_name REGEXP #{fieldName} AND field_address REGEXP #{fieldAddress} AND field_status = true
	</select>
	
	<!-- 특정 구장 정보 불러오기(상세페이지) -->
    <select id="selectField" parameterType="Integer" resultType="com.kosta.project.dto.FieldDTO">
		SELECT f.field_seq AS fieldSeq, field_name AS fieldName, field_img AS fieldImg, field_address AS fieldAddress, field_address_detail AS fieldAddressDetail,
               shower_room AS showerRoom, rent_ball AS rentBall, rent_shoes AS rentShoes, parking, sell_drink AS sellDrink
    	FROM fields f, field_imgs fi
        WHERE f.field_seq = #{fieldSeq} and f.field_seq = fi.field_seq AND field_status = true
	</select>
	
	<!-- 구장 정보 조회(매칭신청 할 때) -->
	<select id="selectFieldInfo" resultType="com.kosta.project.dto.FieldsDTO" parameterType="java.lang.Integer">
		SELECT field_name as fieldName, MIN(field_img) as fieldImg, field_address as fieldAddress, field_address_detail as fieldAddressDetail,
		shower_room as showerRoom, rent_ball as rentBall, rent_shoes as rentShoes, parking, sell_drink as sellDrink
		FROM fields f, field_imgs fi
		WHERE f.field_seq = #{fieldSeq}
		AND f.field_seq = fi.field_seq
	</select>
	
	
	<!-- 구장 정보 조회(구장 정보 조회용) -->
	<select id="selectFieldInfoDetail" resultType="com.kosta.project.dto.FieldsDTO" parameterType="java.lang.Integer">
		SELECT field_name as fieldName, MIN(field_img) as fieldImg, field_address as fieldAddress, field_address_detail as fieldAddressDetail, field_content as fieldContent
		shower_room as showerRoom, rent_ball as rentBall, rent_shoes as rentShoes, parking, sell_drink as sellDrink
		FROM fields f, field_imgs fi
		WHERE f.field_seq = #{fieldSeq}
		AND f.field_seq = fi.field_seq
	</select>
	
	
	<!-- 매칭리스트에 추가 위해 필요한 구장 정보 조회 -->
	<select id="selectFieldAddressAndName" resultType="com.kosta.project.dto.addMatchingListInfo" parameterType="Integer">
		SELECT field_address, field_name, field_seq FROM fields
		WHERE field_seq = #{fieldSeq};
	</select>
	
	<!-- 영업 중인 구장 조회 -->
	<select id="selectFieldSeq" resultType="Integer">
		SELECT field_seq as fieldSeq 
		FROM fields 
		WHERE field_status = 1
	</select>
	
	<!-- 영업 중인 구장 지역별 조회 -->
	<select id="selectFieldSeqByRegion" resultType="Integer" parameterType="String">
		SELECT field_seq as fieldSeq 
		FROM fields
		WHERE field_status = 1
		AND field_address REGEXP #{fieldAddress}
	</select>
	
	<!-- 닫힌 시간대 조회 -->
	<select id="selectCloseTime" resultType="Date" parameterType="com.kosta.project.dto.CloseTimeDTO">
		SELECT closed_date as closedDate, closed_time as closedTime 
		FROM field_schedules
		WHERE closed_date = #{closedDate}
		AND closed_time = #{closedTime}
		AND field_seq = #{fieldSeq}
	</select>
	
	<!-- 구장 정보 조회(빠른 신청) -->
	<select id="selectFastMatchingInfo" resultType="com.kosta.project.dto.FieldsDTO" parameterType="Integer">
		SELECT field_img as fieldImg, matching_date as matchingDate, matching_time as matchingTime, 
		matching_tier as matchingTier, field_name as fieldName, field_address as fieldAddress,
		field_address_detail as fieldAddressDetail, shower_room as showerRoom, rent_ball as rentBall, 
		rent_shoes as rentShoes, parking, sell_drink as sellDrink, field_content as fieldContent
		FROM field_imgs fi, matchings m, fields f
		WHERE fi.field_seq = f.field_seq AND f.field_seq = m.field_seq
		AND matching_seq = #{matchingSeq};
	</select>
	
</mapper>